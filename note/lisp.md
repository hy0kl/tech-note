# note

- 有两种方法来表示空列表:用一对不包括任何东西的括号来表示，或用符号 nil 来表示空表。
- `let`是一个最常用的 Common Lisp 的操作符之一，它引入新的局部变量（local variable）
- 给`defparameter`传入符号和值，来创建一个全局变量
- 用`defconstant`来定义一个全局的常量
- 检查某些符号，是否为一个全局变量或常量，使用`boundp`函数
- 普遍的赋值操作符（assignment operator）是`setf`
- 如果`setf`的第一个实参是符号（symbol），且符号不是某个局部变量的名字，则`setf`把这个符号设为全局变量
- `(setq *print-case* :capitalize)`

# 列表操作 (List Operations)

- 用函数`cons`来构造列表
- 取出列表元素的基本函数是`car`和`cdr`
- `listp`
- 用`defun`来定义新函数
- 递归 (Recursion)

-----

# 实用 Common Lisp 编程

## 第2章 周而复始: REPL 简介

- read-eval-print loop
- NIL是lisp版本的逻辑假和空值
- 使用`load`加载一个文件
- 另一种加载文件中有用定义的方法是,先用`compile-file`编译,然后再用`load`加载编译后产生的文件,也就是FASL文件-快速加载文件(fast-load file)的简称.`compile-file`将返回FASL文件的名字.`(load (compile-file "file.lisp"))`

### 第一个程序

```
(format t "hello, world!")
(write-line "hello, world!")
(print "hello, world!")
```

## 第3章 简单的数据库

- 属性列表(property list, plist): 从第一个元素开始的所有相间元素都是一个用来描述接下来的那个元素的符号.
- 关键字符号是任何以冒号开始的名字.
- `getf`接受一个plist和一个符号,并返回plist中跟在那个符号后面的值.
- 使用`defvar`宏来定义全局变量,名字中的星号是lisp的全局变量命名约定.
- `t`是标准输出流(\*standard-output\*)的简称
- `~a`指令是美化指令,它的意图是消耗一个实参,然后将其输出成人类可读的形式.这将使得关键字被渲染成不带前导冒号的形式,而字符串也不再有引号了.
- `-t`指令用于制表.`~10t`告诉`format`产生足够的空格,以确保在处理下一个`~a`之前光标移动10列.`~t`指令不使用任何实参.
- `~%` 指令并不消耗任何实参,而是告诉`format`来产生一个换行.
- `setf`宏是CommonLisp最主要的赋值操作符.它将其第一个参数设置成其第二个参数的求值结果.
- 函数`remove-if-not`接受一个谓词和一个原始列表,然后返回一个仅包含原始列表中匹配该谓词的所有元素的新列表.谓词参数可以是任何接受单一参数并能返回布尔值的函数---除了NIL表示假以外其余的都表示真.
- `#'`记号是"获取函数,其名如下"的简称.
- `lambda`并不是函数的名字,它只是一个表明正在定义匿名函数的指示器.但除了缺少名字以外,一个`lambda`表达式看起来很像一个`defun`:单词`lambda`后面紧跟着形参列表,然后是函数体.
- 关键字形参(keyword parameter),形参列表开始处有一个`&key`.如果一个特定的关键字在调用中没有指定,对应的变量将被设置成NIL.
- 为了区分作为实参显示传递给关键字形参的NIL和作为默认值的NIL,可以将简单的名称替换成一个包括形参名,默认值和另一个称为`supplied-p`形参的列表.`supplied-p`形参可被设置成真或假,具体取决于实参在特定的函数调用里是否真的被传入相应的关键字形参中.
- `remove-if`所返回的列表中,所有确实匹配谓词的元素都被删除.
- `reverse`函数授受一个列表作为参数并返回一个逆序的新列表.
- 宏与函数的主要词法差异在于需要用`defmacro`而不是`defun`来定义一个宏.
- 在一个反引用表达式里,任何以逗号开始的子表达式都是被求值的.
- `,@`是`,`的变体,可以将接下来的表达式(必须求值成一个列表)的值嵌入到其外围的列表里.
- `&rest`改变了解析参数的方式.当参数列表里面带有`&rest`时,一个函数或宏可以接受任意数量的实参,它们将被收集到一个单一列表中,并成为那个跟在`&rest`后面的名字对应的变量的值.

## 第4章 语法和语义

- `S-表达式`的基本元素是列表(list)的原子(atom).列表由括号所包围,并可包含任何数量的由空格所分隔的元素.原子是所有其他内容.
- 列表元素本身也可以是`S-表达式`(换句话说,也就是原子或嵌套的列表).
- 注释从技术角度来讲不是`S-表达式`,它们以分号开始,直到一行的结尾,本质上将被当作空白来处理.
- 字符串是由双引号所包围着的.在字符串中,一个反斜杠会转义接下来的任意字符,使其被包含在字符串里.两个在字符串中**必须被转义**的字符是双引号和反斜杠本身.
- 有十个字符被用于其他句法目的而不能出现在名字里,它们是:开括号和闭括号,双引号和单引号,反引号,逗号,冒号,分号,反斜杠以及竖线.
- 无论是任何地方,同样的名字出现在任何`S-表达式`里,都会用同一个对象去表示它.
- 全局变量名字在开始和结尾处带有"\*".常量名都以"+"开始和结尾.
- 函数调用形式(function call form),宏形式(macro form)和特殊形式(special form).
- 在`Common Lisp`中一个符号可以同时为操作符(函数,宏或特殊操作符)和变量命名.
- 通常作为宏的循环结构都带有一个以`do`开始的名字.
- NIL是唯一一个既是原子又是列表的对象:除了用来表示假以外,它还用来表示空列表.
- 表达式nil,(),'nil以及'()求值结果是相同的---未引用形式将被看成是对值为符号NIL的常值变量的引用来进行求值,而在引用形式中,QUOTE特殊操作符将会直接求解出符号NIL.
- t和't的求值结果完全相同:符号T.
- `=`用来比较数字,`CHAR=`用来比较字符

### 函数调用

函数调用形式的基本语法应如下所示,其中每个参数本身也是一个Lisp形式:

```
(function-name argument*)
```

### 特殊操作符

IF的规则:求值第一个表达式.如果得到非NIL,那么求值下一个表达式并返回它的值.否则,返回第三个表达式的求值,或者如果第三个表达式被省略的话,返回NIL.形式如下:

```
(if test-form then-form [ else-form ])
```

QUOTE操作符接受一个单一表达式作为其"参数"并简单地返回它,不经求值.它被用得相当普遍,读取器中内置了一个它的特别语法形式:`'`

LET用来创建新的变量绑定.

宏形式的求值过程包括两个阶段:首先,宏形式的元素不经求值即被传递到宏函数里;其次,由宏函数所返回的形式(称其为展开式(expansion))按照正常的求值规则进行求值.

### 真,假和等价

符号NIL是唯一的假值,其他所有的都是真值.符号T是标准的真值,可用于需要返回一个非NIL值却又没有其他值可用的情况.

### "通用"等价谓词

- EQ用来测试"对象标识",只有当两对象相同时才是EQ等价.
- EQL可获得与EQ相似的行为,除此之外,它也可以保证当相同类型的两个对象表示相同的数字或字符值时,它们是等价的.
- EQUAL和EQUALP可以操作在所有类型的对象上,它们每个都定义了相比EQL稍微宽松一些的等价性,允许认为不同的对象是等价的.
  - EQUAL相比EQL的宽松之处在于,它将在递归上具有相同结构和内容的列表视为等价.
  - EQUALP在考察两个含有相同字符串的等价时忽略了大小写的区别.

## 第5章 函数

- 宏运行在编译期,它们生成的代码,即当所有宏被展开后将实际构成程序的那些代码,将完全由对函数和特殊操作符的调用所构成.宏本身也是函数---用来生成代码,而不是用来完成实际的程序操作.
- 任何符号都可用作函数名.
- 如果一个字符串紧跟在形参列表之后,那么它应该是一个用来描述函数用途的文档字符串.定义函数时,该文档字符串将被关联到函数名上,并且以后可通`DOCUMENTATION`函数来获取.
- 一个`DEFUN`的主体可由任意数量的Lisp表达式构成,它们将在函数被调用时依次求值,而最后一个表达式的值被作为整个函数的值返回.
- `RETURN-FROM`特殊操作符可用于从函数的任何位置立即返回.
- 如果一个函数以过多或过少的实参来调用的话,Lisp会报错.

### 定义新函数

```
(defun name (parameter*)
  "Optional documentation string."
  body-form*)
```

### 可选形参

- 为了定义一个带有可选形参的函数,在必要形参的名字之后放置符号`&optional`,后接可选形参的名字.
- 如果实参在所有的可选形参被赋值之前用完了,那么其余的可选形参将自动绑定到值`NIL`上.
- 如果想要一个不同于`NIL`的默认值,可以通过将形参名替换成一个含有名字跟一个表达式的列表来指定该默认值.只有在调用者没有传递足够的实参来为可选形参提供值的时候,表达式才会被求值.
- 默认表达式可以引用早先出现在形参列表中的形参.
- 如果要确认一个可选形参的值究竟是被调用者明确指定还是使用了默认值,可以通过在形参标识符的默认值表达式之后添加另一个变量,该变量将在调用者实际为该形参提供了一个实参时被绑定到真值,否则为`NIL`.通常约定,这种变量的名字与对应的真实形参相同,但是带有一个`-supplied-p`后缀.

### 剩余形参

Lisp允许在符号`&rest`之后包括一揽子形参.如果函数带有`&rest`形参,那么任何满足了必要和可选形参之后的其余所有实参就将被收集到一个列表里成为该`&rest`形参的值.

### 关键字形参

- 关键字形参允许调用者指定具体形参相应所使用的值.为了使函数带有关键字形参,在任何必要的`&optional`和`&rest`形参之后,可以加上符号`&key`以及任意数量的关键字形参标识符,后者的格式类似于可选形参标识符.
- 关键字形参也可以提供一个默认值形式以及一个`supplied-p`变量名.
- 在关键字形参和可选形参中,默认值形式都可以引用那些早先出现在形参列表中的形参.

### 混合不同的形参类型

- 声明顺利:首选是必要形参,其次是可选形参,再次是剩余形参,最后才是关键字形参.

### 函数返回值


